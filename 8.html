<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC28æ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #1a237e, #311b92);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.8;
        }
        
        .controls {
            padding: 20px;
            background: #f5f5f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        button {
            background: linear-gradient(to right, #1a237e, #311b92);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .refresh-btn {
            background: linear-gradient(to right, #00c853, #64dd17);
        }
        
        .demo-btn {
            background: linear-gradient(to right, #ff9800, #ff5722);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #1a237e;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .data-section {
            padding: 20px;
        }
        
        .section-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: #1a237e;
            border-bottom: 2px solid #1a237e;
            padding-bottom: 8px;
        }
        
        .latest-data {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .data-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #1a237e;
        }
        
        .calculation {
            background: #e8eaf6;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .step {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }
        
        .result {
            background: #1a237e;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }
        
        .betting-advice {
            font-size: 22px;
            font-weight: bold;
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .bet-option {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 50px;
            font-weight: bold;
        }
        
        .recommend {
            background: linear-gradient(to right, #00c853, #64dd17);
            color: white;
        }
        
        .avoid {
            background: linear-gradient(to right, #d50000, #ff5131);
            color: white;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .history-table th {
            background: #1a237e;
            color: white;
            padding: 12px 15px;
            text-align: left;
        }
        
        .history-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .history-table tr:nth-child(even) {
            background: #f5f5f5;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #f5f5f5;
            color: #666;
        }
        
        .demo-data {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .api-status {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .api-error {
            background: #ffebee;
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .algorithm-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .algorithm-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #4caf50;
        }
        
        .confidence-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(to right, #4caf50, #8bc34a);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .special-codes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }
        
        .special-code {
            background: #ff9800;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .comprehensive-result {
            background: linear-gradient(to right, #1a237e, #311b92);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PC28æ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ</h1>
            <div class="subtitle">åŸºäºæœŸå·ä¸å’Œå€¼ç®—æ³•çš„å¤šç»´åº¦æ™ºèƒ½åˆ†æç³»ç»Ÿ</div>
        </header>
        
        <div class="controls">
            <div>
                <button id="fetchData">è·å–æœ€æ–°æ•°æ®</button>
                <button id="refreshData" class="refresh-btn">åˆ·æ–°æ•°æ®</button>
                <button id="useDemoData" class="demo-btn">ä½¿ç”¨æ¼”ç¤ºæ•°æ®</button>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            æ­£åœ¨è·å–æœ€æ–°å¼€å¥–æ•°æ®...
        </div>
        
        <div class="data-section">
            <div class="api-status" id="apiStatus" style="display: none;">
                <strong>APIçŠ¶æ€ï¼š</strong><span id="apiStatusText">æ­£åœ¨æ£€æŸ¥...</span>
            </div>
            
            <div class="demo-data" id="demoDataNotice">
                <strong>æ¼”ç¤ºæ¨¡å¼ï¼š</strong>å½“å‰ä½¿ç”¨æ¼”ç¤ºæ•°æ®ï¼Œç‚¹å‡»"è·å–æœ€æ–°æ•°æ®"å°è¯•è¿æ¥çœŸå®API
            </div>
            
            <div class="section-title">æœ€æ–°å¼€å¥–æ•°æ®</div>
            <div class="latest-data" id="latestData"></div>
            
            <div class="calculation">
                <div class="section-title">ç­–ç•¥è®¡ç®—è¿‡ç¨‹</div>
                <div class="calculation-steps" id="calculationSteps">
                    <p>æ•°æ®åŠ è½½åå°†æ˜¾ç¤ºè¯¦ç»†è®¡ç®—è¿‡ç¨‹</p>
                </div>
            </div>
            
            <div class="section-title">å¤šç®—æ³•é¢„æµ‹ç»“æœ</div>
            <div class="algorithm-results" id="algorithmResults"></div>
            
            <div class="comprehensive-result" id="comprehensiveResult">
                <h2>ç»¼åˆé¢„æµ‹ç»“æœ</h2>
                <div id="comprehensiveContent">
                    <p>ç­‰å¾…æ•°æ®è®¡ç®—...</p>
                </div>
            </div>
            
            <div class="result" id="result">
                <h2>åŸºç¡€ç­–ç•¥åˆ†æç»“æœ</h2>
                <div id="resultContent">
                    <p>ç­‰å¾…æ•°æ®è®¡ç®—...</p>
                </div>
            </div>
            
            <div class="section-title">å†å²å¼€å¥–è®°å½•</div>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>æœŸå·</th>
                        <th>å¼€å¥–æ—¶é—´</th>
                        <th>å¼€å¥–å·ç </th>
                        <th>å’Œå€¼</th>
                        <th>ç±»å‹</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center;">æš‚æ— æ•°æ®</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <footer>
            <p>PC28æ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ &copy; 2025 - æœ¬å·¥å…·ä»…ä¾›æ•°æ®åˆ†æå‚è€ƒ</p>
        </footer>
    </div>

    <script>
        // æ¼”ç¤ºæ•°æ®
        const demoData = [
            { "qihao": "3354518", "opentime": "11-01 20:25:46", "opennum": "9+4+4", "sum": "17" },
            { "qihao": "3354517", "opentime": "11-01 20:22:00", "opennum": "3+5+2", "sum": "10" },
            { "qihao": "3354516", "opentime": "11-01 20:18:30", "opennum": "3+4+1", "sum": "8" },
            { "qihao": "3354515", "opentime": "11-01 20:15:00", "opennum": "4+4+6", "sum": "14" },
            { "qihao": "3354514", "opentime": "11-01 20:11:30", "opennum": "3+4+6", "sum": "13" },
            { "qihao": "3354513", "opentime": "11-01 20:08:00", "opennum": "2+5+6", "sum": "13" },
            { "qihao": "3354512", "opentime": "11-01 20:04:30", "opennum": "1+3+5", "sum": "9" },
            { "qihao": "3354511", "opentime": "11-01 20:01:00", "opennum": "4+2+1", "sum": "7" },
            { "qihao": "3354510", "opentime": "11-01 19:57:30", "opennum": "6+3+2", "sum": "11" },
            { "qihao": "3354509", "opentime": "11-01 19:54:00", "opennum": "5+4+3", "sum": "12" }
        ];

        // ç‰¹æ®Šå·ç æ˜ å°„
        const specialCodes = {
            "å°åŒ": ["00", "02", "04", "06", "08", "10", "12"],
            "å°å•": ["01", "03", "05", "07", "09", "11", "13"],
            "å¤§åŒ": ["14", "16", "18", "20", "22", "24", "26"],
            "å¤§å•": ["15", "17", "19", "21", "23", "25", "27"]
        };

        // è§£æå¼€å¥–å·ç 
        function parseOpennum(opennum) {
            const numbers = opennum.replace(/\s/g, '').split('+');
            return {
                first: parseInt(numbers[0]) || 0,
                second: parseInt(numbers[1]) || 0,
                third: parseInt(numbers[2]) || 0
            };
        }

        // è·å–æ•°å­—çš„ä¸ªä½æ•°å’Œåä½æ•°
        function getTensAndOnes(number) {
            return {
                tens: Math.floor((number % 100) / 10),
                ones: number % 10
            };
        }

        // æ ¹æ®å’Œå€¼è·å–ç±»å‹
        function getTypeBySum(sum) {
            if (sum <= 13) {
                return sum % 2 === 0 ? "å°åŒ" : "å°å•";
            } else {
                return sum % 2 === 0 ? "å¤§åŒ" : "å¤§å•";
            }
        }

        // æ ¹æ®æ•°å­—è·å–ç±»å‹
        function getTypeByNumber(number) {
            number = Math.abs(number) % 28;
            if (number <= 13) {
                return number % 2 === 0 ? "å°åŒ" : "å°å•";
            } else {
                return number % 2 === 0 ? "å¤§åŒ" : "å¤§å•";
            }
        }

        // è·å–äº’è¡¥ç±»å‹
        function getComplementaryType(baseType) {
            const complementaryMap = {
                "å¤§å•": "å°åŒ", "å¤§åŒ": "å°å•",
                "å°å•": "å¤§åŒ", "å°åŒ": "å¤§å•"
            };
            return complementaryMap[baseType] || "å¤§åŒ";
        }

        // æœŸå·å’Œå€¼ç®—æ³•1: åŸºç¡€æ’é™¤ç®—æ³•
        function periodSumAlgorithm1(data) {
            if (data.length < 3) return { result: "å¤§å•å¤§åŒ", confidence: 50 };
            
            // è·å–æœŸå·åä¸¤ä½å’Œå’Œå€¼
            const periodSuffix = data[0].period.length >= 2 ? 
                parseInt(data[0].period.slice(-2)) : parseInt(data[0].period);
            const currentSum = data[0].sum;
            
            // è®¡ç®—æ’é™¤ç±»å‹
            const A = data[1].sum % 10;
            const B = data[1].numbers[1];
            const C = data[2].sum % 10;
            
            let S = (A + B + C + 8) * 2;
            if (S > 27) S = S - 27;
            
            const excludeType = getTypeByNumber(S);
            
            // æ„å»ºå€™é€‰ç±»å‹
            const allTypes = ["å¤§å•", "å¤§åŒ", "å°å•", "å°åŒ"];
            const candidateTypes = allTypes.filter(type => type !== excludeType);
            
            // åŸºäºæœŸå·å’Œå’Œå€¼é€‰æ‹©ç±»å‹
            const calcValue = (periodSuffix + currentSum) % 4;
            let result;
            
            if (calcValue === 0) {
                result = candidateTypes[0] + candidateTypes[1];
            } else if (calcValue === 1) {
                result = candidateTypes[1] + (candidateTypes[2] || candidateTypes[0]);
            } else if (calcValue === 2) {
                result = (candidateTypes[2] || candidateTypes[0]) + candidateTypes[0];
            } else {
                result = candidateTypes[0] + (candidateTypes[2] || candidateTypes[1]);
            }
            
            return { 
                result: result, 
                confidence: 75,
                description: "åŸºç¡€æ’é™¤ç®—æ³•: åŸºäºæœŸå·ã€å’Œå€¼å’Œæ’é™¤æ³•è®¡ç®—"
            };
        }

        // æœŸå·å’Œå€¼ç®—æ³•2: æœŸå°¾å’Œå€¼ç»¼åˆç®—æ³•
        function periodSumAlgorithm2(data) {
            if (data.length < 2) return { result: "å¤§å•å¤§åŒ", confidence: 50 };
            
            // è·å–æœŸå·åä¸¤ä½å’Œæœ€æ–°å’Œå€¼
            const periodSuffix = data[0].period.length >= 2 ? 
                parseInt(data[0].period.slice(-2)) : parseInt(data[0].period);
            const currentSum = data[0].sum;
            const prevSum = data[1].sum;
            
            // è®¡ç®—é¢„æµ‹å€¼
            const calc1 = (periodSuffix * currentSum) % 28;
            const calc2 = (periodSuffix + currentSum + prevSum) % 28;
            
            const type1 = getTypeByNumber(calc1);
            const type2 = getTypeByNumber(calc2);
            
            // å¦‚æœä¸¤ä¸ªç±»å‹ç›¸åŒï¼Œé€‰æ‹©äº’è¡¥ç±»å‹
            let result;
            if (type1 === type2) {
                const complementary = getComplementaryType(type1);
                result = type1 + complementary;
            } else {
                result = type1 + type2;
            }
            
            return { 
                result: result, 
                confidence: 70,
                description: "æœŸå°¾å’Œå€¼ç»¼åˆç®—æ³•: åŸºäºæœŸå·å°¾æ•°å’Œå¤šæœŸå’Œå€¼è®¡ç®—"
            };
        }

        // æœŸå·å’Œå€¼ç®—æ³•3: æœŸå·å˜æ¢ç®—æ³•
        function periodSumAlgorithm3(data) {
            if (data.length < 3) return { result: "å¤§å•å¤§åŒ", confidence: 50 };
            
            // è·å–æœŸå·åä¸¤ä½
            const periodSuffix = data[0].period.length >= 2 ? 
                parseInt(data[0].period.slice(-2)) : parseInt(data[0].period);
            
            // è·å–æœ€è¿‘ä¸‰æœŸå’Œå€¼
            const sum1 = data[0].sum;
            const sum2 = data[1].sum;
            const sum3 = data[2].sum;
            
            // è®¡ç®—é¢„æµ‹å€¼
            const calc1 = (periodSuffix * sum1 + sum2) % 28;
            const calc2 = (periodSuffix + sum1 + sum2 + sum3) % 28;
            
            const type1 = getTypeByNumber(calc1);
            const type2 = getTypeByNumber(calc2);
            
            return { 
                result: type1 + type2, 
                confidence: 65,
                description: "æœŸå·å˜æ¢ç®—æ³•: åŸºäºæœŸå·å˜æ¢å’Œå¤šæœŸå’Œå€¼è®¡ç®—"
            };
        }

        // æœŸå·å’Œå€¼ç®—æ³•4: å’Œå€¼è¶‹åŠ¿ç®—æ³•
        function periodSumAlgorithm4(data) {
            if (data.length < 5) return { result: "å¤§å•å¤§åŒ", confidence: 50 };
            
            // è·å–æœŸå·åä¸¤ä½
            const periodSuffix = data[0].period.length >= 2 ? 
                parseInt(data[0].period.slice(-2)) : parseInt(data[0].period);
            
            // åˆ†æå’Œå€¼è¶‹åŠ¿
            const recentSums = data.slice(0, 5).map(item => item.sum);
            let sumTrend = 0;
            for (let i = 0; i < recentSums.length - 1; i++) {
                sumTrend += recentSums[i] - recentSums[i + 1];
            }
            
            // è®¡ç®—é¢„æµ‹å€¼
            let calc1, calc2;
            if (sumTrend > 0) {  // å’Œå€¼ä¸Šå‡è¶‹åŠ¿
                calc1 = (periodSuffix + recentSums[0] + 5) % 28;
                calc2 = (periodSuffix * 2 + recentSums[0]) % 28;
            } else {  // å’Œå€¼ä¸‹é™è¶‹åŠ¿
                calc1 = (periodSuffix + recentSums[0] - 5) % 28;
                calc2 = (periodSuffix * 3 - recentSums[0]) % 28;
            }
            
            const type1 = getTypeByNumber(calc1);
            const type2 = getTypeByNumber(calc2);
            
            return { 
                result: type1 + type2, 
                confidence: 70,
                description: "å’Œå€¼è¶‹åŠ¿ç®—æ³•: åŸºäºå’Œå€¼è¶‹åŠ¿å’ŒæœŸå·è®¡ç®—"
            };
        }

        // æœŸå·å’Œå€¼ç®—æ³•5: æœŸå°¾å€æ•°ç®—æ³•
        function periodSumAlgorithm5(data) {
            if (data.length < 2) return { result: "å¤§å•å¤§åŒ", confidence: 50 };
            
            // è·å–æœŸå·åä¸¤ä½
            const periodSuffix = data[0].period.length >= 2 ? 
                parseInt(data[0].period.slice(-2)) : parseInt(data[0].period);
            const currentSum = data[0].sum;
            
            // è®¡ç®—æœŸå°¾å€æ•°
            let periodMultiple = periodSuffix % 10;
            if (periodMultiple === 0) periodMultiple = 1;
            
            // è®¡ç®—é¢„æµ‹å€¼
            const calc1 = (periodSuffix * periodMultiple + currentSum) % 28;
            const calc2 = (periodSuffix + currentSum * periodMultiple) % 28;
            
            const type1 = getTypeByNumber(calc1);
            const type2 = getTypeByNumber(calc2);
            
            // å¦‚æœä¸¤ä¸ªç±»å‹ç›¸åŒï¼Œé€‰æ‹©äº’è¡¥ç±»å‹
            let result;
            if (type1 === type2) {
                const complementary = getComplementaryType(type1);
                result = type1 + complementary;
            } else {
                result = type1 + type2;
            }
            
            return { 
                result: result, 
                confidence: 65,
                description: "æœŸå°¾å€æ•°ç®—æ³•: åŸºäºæœŸå·å°¾æ•°å€æ•°å’Œå’Œå€¼è®¡ç®—"
            };
        }

        // æ¨èç‰¹ç 
        function recommendCodes(doubleGroup, data) {
            if (doubleGroup.length !== 4) return [];
            
            const type1 = doubleGroup.substring(0, 2);
            const type2 = doubleGroup.substring(2, 4);
            const codes1 = specialCodes[type1] || [];
            const codes2 = specialCodes[type2] || [];
            
            // åˆå¹¶ç‰¹ç 
            const allCodes = [...new Set([...codes1, ...codes2])];
            
            if (allCodes.length === 0) return [];
            
            // åŸºäºæœŸå·å’Œå’Œå€¼ä¼˜åŒ–é€‰æ‹©
            const periodSuffix = data[0].period.length >= 2 ? 
                parseInt(data[0].period.slice(-2)) : parseInt(data[0].period);
            const currentSum = data[0].sum;
            
            // è®¡ç®—æƒé‡
            const weightedCodes = [];
            for (const code of allCodes) {
                const codeNum = parseInt(code);
                
                // åŸºäºæœŸå·å’Œå’Œå€¼è®¡ç®—æƒé‡
                const periodWeight = 1.0 / (1 + Math.abs(codeNum - periodSuffix));
                const sumWeight = 1.0 / (1 + Math.abs(codeNum - currentSum));
                
                const totalWeight = periodWeight * 0.6 + sumWeight * 0.4;
                weightedCodes.push({ code, weight: totalWeight });
            }
            
            // æŒ‰æƒé‡æ’åº
            weightedCodes.sort((a, b) => b.weight - a.weight);
            
            // è¿”å›å‰4ä¸ª
            return weightedCodes.slice(0, 4).map(item => item.code);
        }

        // è®¡ç®—ç½®ä¿¡åº¦
        function calculateConfidence(resultCounts, algorithmCount, data) {
            if (data.length < 10) return 50;
            
            // åŸºç¡€ç½®ä¿¡åº¦
            let confidence = 70;
            
            // åŸºäºç®—æ³•ä¸€è‡´æ€§å¢åŠ ç½®ä¿¡åº¦
            const mostCommonCount = Math.max(...Object.values(resultCounts));
            if (mostCommonCount >= 4) {
                confidence += 25;
            } else if (mostCommonCount >= 3) {
                confidence += 15;
            } else if (mostCommonCount >= 2) {
                confidence += 10;
            }
            
            // åŸºäºæ•°æ®è´¨é‡å¢åŠ ç½®ä¿¡åº¦
            if (data.length >= 40) {
                confidence += 10;
            } else if (data.length >= 25) {
                confidence += 5;
            }
            
            return Math.min(95, confidence);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const fetchDataBtn = document.getElementById('fetchData');
            const refreshDataBtn = document.getElementById('refreshData');
            const useDemoDataBtn = document.getElementById('useDemoData');
            const loadingElement = document.getElementById('loading');
            const latestDataElement = document.getElementById('latestData');
            const calculationStepsElement = document.getElementById('calculationSteps');
            const resultElement = document.getElementById('resultContent');
            const historyTableBody = document.getElementById('historyTableBody');
            const demoDataNotice = document.getElementById('demoDataNotice');
            const apiStatus = document.getElementById('apiStatus');
            const apiStatusText = document.getElementById('apiStatusText');
            const algorithmResultsElement = document.getElementById('algorithmResults');
            const comprehensiveResultElement = document.getElementById('comprehensiveContent');

            // åˆå§‹åŠ è½½æ¼”ç¤ºæ•°æ®
            loadDemoData();

            // æŒ‰é’®äº‹ä»¶
            fetchDataBtn.addEventListener('click', fetchRealData);
            refreshDataBtn.addEventListener('click', fetchRealData);
            useDemoDataBtn.addEventListener('click', loadDemoData);

            function loadDemoData() {
                processData(demoData);
                demoDataNotice.style.display = 'block';
                apiStatus.style.display = 'block';
                apiStatusText.innerHTML = 'ä½¿ç”¨æ¼”ç¤ºæ•°æ®æ¨¡å¼';
                apiStatus.className = 'api-status';
            }

            async function fetchRealData() {
                loadingElement.style.display = 'block';
                demoDataNotice.style.display = 'none';
                apiStatus.style.display = 'block';
                apiStatusText.innerHTML = 'æ­£åœ¨è¿æ¥API...';
                
                try {
                    const response = await fetch('https://pc28.help/kj.json?limit=50&no_cache=false');
                    
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // å¤„ç†æ•°æ®æ ¼å¼
                    let processedData = data;
                    if (!Array.isArray(data)) {
                        if (data.data && Array.isArray(data.data)) {
                            processedData = data.data;
                        } else {
                            throw new Error('APIè¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                        }
                    }
                    
                    processData(processedData);
                    apiStatusText.innerHTML = `APIè¿æ¥æˆåŠŸ - è·å–åˆ° ${processedData.length} æœŸæ•°æ®`;
                    apiStatus.className = 'api-status';
                    
                } catch (error) {
                    apiStatusText.innerHTML = `APIè¿æ¥å¤±è´¥: ${error.message}`;
                    apiStatus.className = 'api-error';
                    loadDemoData();
                } finally {
                    loadingElement.style.display = 'none';
                }
            }

            function processData(data) {
                if (!Array.isArray(data) || data.length < 3) {
                    latestDataElement.innerHTML = '<div class="data-card"><h3>æ•°æ®ä¸è¶³</h3><p>æ— æ³•è¿›è¡Œè®¡ç®—</p></div>';
                    return;
                }

                // æ ¼å¼åŒ–æ•°æ®
                const formattedData = data.map(item => {
                    const parsed = parseOpennum(item.opennum);
                    return {
                        period: item.qihao,
                        numbers: [parsed.first, parsed.second, parsed.third],
                        sum: parseInt(item.sum),
                        type: getTypeBySum(parseInt(item.sum)),
                        time: item.opentime
                    };
                });

                displayLatestData(formattedData.slice(0, 5));
                displayHistoryData(formattedData);
                calculateBasicStrategy(formattedData);
                runAdvancedAlgorithms(formattedData);
            }

            function displayLatestData(latestData) {
                let html = '';
                latestData.forEach((item, index) => {
                    html += `
                        <div class="data-card">
                            <h3>ç¬¬${index + 1}æœŸ - æœŸå·: ${item.period}</h3>
                            <p><strong>å¼€å¥–å·ç :</strong> ${item.numbers.join('+')}</p>
                            <p><strong>å’Œå€¼:</strong> ${item.sum} ${item.type}</p>
                            <p><strong>å¼€å¥–æ—¶é—´:</strong> ${item.time}</p>
                        </div>
                    `;
                });
                latestDataElement.innerHTML = html;
            }

            function displayHistoryData(data) {
                let html = '';
                data.forEach(item => {
                    html += `<tr>
                        <td>${item.period}</td>
                        <td>${item.time}</td>
                        <td>${item.numbers.join('+')}</td>
                        <td>${item.sum}</td>
                        <td>${item.type}</td>
                    </tr>`;
                });
                historyTableBody.innerHTML = html;
            }

            function calculateBasicStrategy(data) {
                const latestThree = data.slice(0, 3);
                const firstPositions = [], secondPositions = [], thirdPositions = [], sums = [];
                
                let stepsHtml = '<div class="step"><strong>æ­¥éª¤1: æå–æœ€æ–°3æœŸæ•°æ®å¹¶æ‹†åˆ†å·ç </strong></div>';
                
                latestThree.forEach((item, index) => {
                    firstPositions.push(item.numbers[0]);
                    secondPositions.push(item.numbers[1]);
                    thirdPositions.push(item.numbers[2]);
                    sums.push(item.sum);
                    
                    stepsHtml += `<div class="step">
                        ç¬¬${index + 1}æœŸ: å·ç ${item.numbers.join('+')} â†’ ç¬¬ä¸€ä½=${item.numbers[0]}, ç¬¬äºŒä½=${item.numbers[1]}, ç¬¬ä¸‰ä½=${item.numbers[2]}, å’Œå€¼=${item.sum}
                    </div>`;
                });
                
                const S1 = firstPositions.reduce((a, b) => a + b, 0);
                const S2 = secondPositions.reduce((a, b) => a + b, 0);
                const S3 = thirdPositions.reduce((a, b) => a + b, 0);
                const T1 = sums[0];
                const R = T1 !== 0 ? Math.floor((S1 * S2 * S3) / T1) : 0;
                const { tens, ones } = getTensAndOnes(R);
                const tensType = tens % 2 === 0 ? 'åŒ' : 'å•';
                const onesType = ones % 2 === 0 ? 'åŒ' : 'å•';
                
                stepsHtml += `
                    <div class="step"><strong>æ­¥éª¤2: è®¡ç®—å„é¡¹å’Œå€¼</strong></div>
                    <div class="step">ç¬¬ä¸€ä½å·ç : [${firstPositions.join(', ')}] â†’ å’Œå€¼ S1 = ${S1}</div>
                    <div class="step">ç¬¬äºŒä½å·ç : [${secondPositions.join(', ')}] â†’ å’Œå€¼ S2 = ${S2}</div>
                    <div class="step">ç¬¬ä¸‰ä½å·ç : [${thirdPositions.join(', ')}] â†’ å’Œå€¼ S3 = ${S3}</div>
                    <div class="step">æœ€æ–°ä¸€æœŸå’Œå€¼ T1 = ${T1}</div>
                    <div class="step"><strong>æ­¥éª¤3: è®¡ç®—ç­–ç•¥å…¬å¼</strong></div>
                    <div class="step">R = (S1 Ã— S2 Ã— S3) Ã· T1 = (${S1} Ã— ${S2} Ã— ${S3}) Ã· ${T1} = ${R}</div>
                    <div class="step"><strong>æ­¥éª¤4: åˆ†æRçš„ä¸ªä½æ•°å’Œåä½æ•°</strong></div>
                    <div class="step">R = ${R} â†’ åä½æ•°: ${tens}(${tensType}), ä¸ªä½æ•°: ${ones}(${onesType})</div>
                `;
                
                calculationStepsElement.innerHTML = stepsHtml;
                
                let resultHtml = '';
                if (tensType === 'åŒ' && onesType === 'åŒ') {
                    resultHtml = `
                        <div style="font-size: 20px; margin-bottom: 15px;">ğŸ”´ å‡ºç°ä¸¤ä¸ªåŒ â†’ æ€åŒ</div>
                        <div class="betting-advice">æŠ•æ³¨å»ºè®®</div>
                        <div>
                            <span class="bet-option recommend">å¤§å•</span>
                            <span class="bet-option recommend">å°å•</span>
                        </div>
                        <div style="margin-top: 15px;">
                            <span class="bet-option avoid">å¤§åŒ</span>
                            <span class="bet-option avoid">å°åŒ</span>
                        </div>
                    `;
                } else if (tensType === 'å•' && onesTy=== 'å•') {
                    resultHtml = `
                        <div style="font-size: 20px; margin-bottom: 15px;">ğŸ”´ å‡ºç°ä¸¤ä¸ªå• â†’ æ€å•</div>
                        <div class="betting-advice">æŠ•æ³¨å»ºè®®</div>
                        <div>
                            <span class="bet-option recommend">å¤§åŒ</span>
                            <span class="bet-option recommend">å°åŒ</span>
                        </div>
                        <div style="margin-top: 15px;">
                            <span class="bet-option avoid">å¤§å•</span>
                            <span class="bet-option avoid">å°å•</span>
                        </div>
                    `;
                } else {
                    resultHtml = `
                        <div style="font-size: 20px; margin-bottom: 15px;">âš ï¸ ä¸€å•ä¸€åŒï¼Œæ— æ˜ç¡®æ–¹å‘</div>
                        <div class="betting-advice">å»ºè®®è§‚æœ›</div>
                    `;
                }
                
                const latest = data[0];
                resultHtml += `
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                        <p>æœ€æ–°ä¸€æœŸ: æœŸå·${latest.period} å¼€å¥–${latest.numbers.join('+')} å’Œå€¼${latest.sum} ${latest.type}</p>
                    </div>
                `;
                
                resultElement.innerHTML = resultHtml;
            }

            function runAdvancedAlgorithms(data) {
                // è¿è¡Œæ‰€æœ‰ç®—æ³•
                const algorithms = [
                    periodSumAlgorithm1,
                    periodSumAlgorithm2,
                    periodSumAlgorithm3,
                    periodSumAlgorithm4,
                    periodSumAlgorithm5
                ];
                
                const results = [];
                let algorithmHtml = '';
                
                algorithms.forEach((algorithm, index) => {
                    const result = algorithm(data);
                    results.push(result);
                    
                    // æ¨èç‰¹ç 
                    const specialCodes = recommendCodes(result.result, data);
                    
                    algorithmHtml += `
                        <div class="algorithm-card">
                            <h3>ç®—æ³• ${index + 1}</h3>
                            <p>${result.description}</p>
                            <p><strong>é¢„æµ‹ç»“æœ:</strong> ${result.result}</p>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${result.confidence}%"></div>
                            </div>
                            <p><strong>ç½®ä¿¡åº¦:</strong> ${result.confidence}%</p>
                            ${specialCodes.length > 0 ? `
                                <p><strong>æ¨èç‰¹ç :</strong></p>
                                <div class="special-codes">
                                    ${specialCodes.map(code => `<span class="special-code">${code}</span>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                algorithmResultsElement.innerHTML = algorithmHtml;
                
                // è®¡ç®—ç»¼åˆç»“æœ
                calculateComprehensiveResult(results, data);
            }

            function calculateComprehensiveResult(results, data) {
                // ç»Ÿè®¡ç»“æœé¢‘ç‡
                const resultCounts = {};
                results.forEach(result => {
                    resultCounts[result.result] = (resultCounts[result.result] || 0) + 1;
                });
                
                // æ‰¾åˆ°å‡ºç°æ¬¡æ•°æœ€å¤šçš„ç»“æœ
                let mostCommonResult = "";
                let maxCount = 0;
                
                for (const [result, count] of Object.entries(resultCounts)) {
                    if (count > maxCount) {
                        maxCount = count;
                        mostCommonResult = result;
                    }
                }
                
                // è®¡ç®—ç»¼åˆç½®ä¿¡åº¦
                const confidence = calculateConfidence(resultCounts, results.length, data);
                
                // æ¨èç‰¹ç 
                const specialCodes = recommendCodes(mostCommonResult, data);
                
                // æ˜¾ç¤ºç»¼åˆç»“æœ
                let comprehensiveHtml = `
                    <div style="font-size: 24px; margin-bottom: 15px;">${mostCommonResult}</div>
                    <div class="confidence-bar" style="width: 80%; margin: 0 auto;">
                        <div class="confidence-fill" style="width: ${confidence}%"></div>
                    </div>
                    <p><strong>ç»¼åˆç½®ä¿¡åº¦:</strong> ${confidence}%</p>
                    <div style="margin: 20px 0;">
                        <span class="bet-option recommend">${mostCommonResult.substring(0, 2)}</span>
                        <span class="bet-option recommend">${mostCommonResult.substring(2, 4)}</span>
                    </div>
                `;
                
                if (specialCodes.length > 0) {
                    comprehensiveHtml += `
                        <div class="betting-advice">æ¨èç‰¹ç </div>
                        <div class="special-codes">
                            ${specialCodes.map(code => `<span class="special-code">${code}</span>`).join('')}
                        </div>
                    `;
                }
                
                comprehensiveResultElement.innerHTML = comprehensiveHtml;
            }
        });
    </script>
</body>
</html>